<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>I love u Nonnyyy</title>

  <!-- Romantic font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --overlay: rgba(0,0,0,.38);
      --glass: rgba(255,255,255,.10);
      --stroke: rgba(255,255,255,.22);
      --text: rgba(255,255,255,.96);
      --muted: rgba(255,255,255,.82);
      --shadow: rgba(0,0,0,.55);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body{
      font-family: Poppins, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: #111 url("background.jpeg") center 35% / cover no-repeat fixed;
      position: relative;
      overflow: hidden;
    }
    body::before{
      content:"";
      position:absolute;
      inset:0;
      background: var(--overlay);
    }

    /* Sparkles (background) */
    .sparkles{ position:absolute; inset:0; pointer-events:none; overflow:hidden; }
    .sparkle{
      position:absolute;
      width: 6px; height: 6px;
      border-radius: 50%;
      background: rgba(255,255,255,.75);
      filter: drop-shadow(0 8px 14px rgba(0,0,0,.25));
      opacity: 0;
      animation: sparkle 4.5s linear infinite;
    }
    @keyframes sparkle{
      0%   { transform: translateY(10vh) scale(.6); opacity: 0; }
      10%  { opacity: .8; }
      60%  { opacity: .9; }
      100% { transform: translateY(-120vh) scale(1.2); opacity: 0; }
    }

    main{
      position: relative;
      height: 100%;
      display: grid;
      place-items: center;
      padding: 22px;
      text-align: center;
    }

    /* Glass card */
    .card{
      width: min(920px, 100%);
      padding: clamp(18px, 3.2vw, 34px);
      border-radius: 26px;
      border: 1px solid var(--stroke);
      background: rgba(20,20,20,.22);
      backdrop-filter: blur(10px);
      box-shadow: 0 22px 70px rgba(0,0,0,.45);
      position: relative;
      overflow: hidden;
      animation: enter 650ms ease-out both;
    }
    .card::after{
      content:"";
      position:absolute;
      inset:-60px;
      background: radial-gradient(circle at 20% 15%, rgba(255,255,255,.12), transparent 40%),
                  radial-gradient(circle at 90% 30%, rgba(255,255,255,.08), transparent 45%);
      pointer-events:none;
    }
    @keyframes enter{
      from { opacity: 0; transform: translateY(18px) scale(.985); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }

    .title{
      margin: 0;
      color: var(--text);
      text-shadow: 0 10px 30px var(--shadow), 0 2px 7px rgba(0,0,0,.35);
      letter-spacing: .5px;
      line-height: 1.05;
    }
    .title .script{
      font-family: "Great Vibes", cursive;
      font-weight: 400;
      font-size: clamp(2.5rem, 7vw, 5.4rem);
      display:block;
      margin-bottom: 6px;
      text-transform: none;
    }
    .title .main{
      font-weight: 800;
      text-transform: lowercase;
      font-size: clamp(1.6rem, 3.5vw, 2.4rem);
      opacity: .95;
      display:block;
    }

    .random{
      margin-top: 12px;
      color: var(--muted);
      font-size: 1rem;
      opacity: .95;
      display: inline-flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
    }
    .shuffle{
      appearance:none;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      padding: 6px 10px;
      border-radius: 999px;
      cursor:pointer;
      transition: transform 160ms ease, background 160ms ease;
    }
    .shuffle:hover{ background: rgba(255,255,255,.14); }
    .shuffle:active{ transform: scale(.98); }

    /* Countdown */
    .countdown{
      margin: 14px auto 8px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content:center;
      color: rgba(255,255,255,.9);
      font-size: .95rem;
    }
    .pill{
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(6px);
      display:inline-flex;
      gap: 8px;
      align-items:center;
    }
    .mono{ font-variant-numeric: tabular-nums; }

    /* Buttons row */
    .btns{
      margin-top: 16px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn{
      appearance:none;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.95);
      border-radius: 999px;
      padding: 10px 14px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      backdrop-filter: blur(8px);
      transition: transform 160ms ease, background 160ms ease;
      box-shadow: 0 10px 24px rgba(0,0,0,.22);
      display:inline-flex;
      gap: 10px;
      align-items:center;
      justify-content:center;
      font-weight: 600;
    }
    .btn:hover{ background: rgba(255,255,255,.14); }
    .btn:active{ transform: scale(.98); }
    .btn:focus-visible{ outline: 2px solid rgba(255,255,255,.55); outline-offset: 3px; }

    /* Special ‚ÄúMost beautiful‚Äù button pulse */
    .btn.primary{
      animation: pulse 2.2s ease-in-out infinite;
      border-color: rgba(255,255,255,.32);
    }
    @keyframes pulse{
      0%,100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }

    /* Hearts float */
    .hearts{
      pointer-events:none;
      position:absolute;
      inset:0;
      overflow:hidden;
    }
    .heart{
      position:absolute;
      bottom:-12vh;
      font-size: clamp(18px, 2.5vw, 34px);
      opacity:0;
      animation: floatUp linear infinite;
      filter: drop-shadow(0 8px 10px rgba(0,0,0,0.3));
      will-change: transform, opacity;
    }
    @keyframes floatUp{
      0% { transform: translateY(0) translateX(0) rotate(0deg); opacity:0; }
      10% { opacity:.85; }
      90% { opacity:.85; }
      100% { transform: translateY(-125vh) translateX(var(--dx, 12vw)) rotate(20deg); opacity:0; }
    }

    /* Heart trail */
    .trail-heart{
      position: absolute;
      pointer-events:none;
      font-size: 18px;
      transform: translate(-50%, -50%);
      opacity: 1;
      animation: pop 900ms ease-out forwards;
      filter: drop-shadow(0 10px 16px rgba(0,0,0,.28));
    }
    @keyframes pop{
      0% { transform: translate(-50%,-50%) scale(.75); opacity: 0; }
      20%{ opacity: .95; }
      100%{ transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(1.25); opacity: 0; }
    }

    /* Modal base */
    .modal{
      position: fixed;
      inset:0;
      display:none;
      place-items:center;
      padding: 16px;
      z-index: 50;
    }
    .modal.open{ display:grid; }
    .modal::before{
      content:"";
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.68);
      backdrop-filter: blur(8px);
    }
    .modal-card{
      position: relative;
      width: min(1000px, 100%);
      max-height: min(86vh, 920px);
      overflow: hidden;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(15,15,15,.75);
      box-shadow: 0 24px 80px rgba(0,0,0,.60);
    }
    .modal-header{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.95);
    }
    .modal-title{ font-weight: 800; font-size: 1rem; }
    .modal-sub{ font-size: .86rem; opacity: .85; margin-top: 3px; }
    .close{
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.95);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
    }
    .close:hover{ background: rgba(255,255,255,.14); }

    /* Gallery */
    .gallery{
      padding: 14px;
      overflow:auto;
      max-height: calc(86vh - 58px);
      display:grid;
      gap: 12px;
      grid-template-columns: repeat(2, 1fr);
    }
    @media (min-width: 720px){ .gallery{ grid-template-columns: repeat(3, 1fr); } }
    @media (min-width: 980px){ .gallery{ grid-template-columns: repeat(4, 1fr); } }

    .tile{
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      text-align:left;
      padding:0;
    }
    .tile img{
      display:block;
      width:100%;
      height: 170px;
      object-fit: cover;
      transition: transform 220ms ease;
    }
    .tile:hover img{ transform: scale(1.05); }
    .cap{
      padding: 10px 10px 12px;
      color: rgba(255,255,255,.92);
      font-size: .88rem;
      opacity: .92;
      line-height: 1.25;
    }

    /* Lightbox */
    .lightbox{
      position: fixed;
      inset:0;
      display:none;
      place-items:center;
      padding:16px;
      z-index: 60;
    }
    .lightbox.open{ display:grid; }
    .lightbox::before{
      content:"";
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.78);
      backdrop-filter: blur(8px);
    }
    .lightbox-inner{
      position: relative;
      width: min(1100px, 100%);
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(10,10,10,.86);
      box-shadow: 0 22px 80px rgba(0,0,0,.65);
    }
    .lightbox-inner img{
      width:100%;
      height: min(74vh, 760px);
      object-fit: contain;
      display:block;
      background: rgba(0,0,0,.25);
    }
    .lb-bar{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      border-top: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.9);
      font-size: .92rem;
    }
    .nav{
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.95);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      white-space: nowrap;
    }
    .nav:hover{ background: rgba(255,255,255,.14); }
    .counter{ opacity: .9; }

    /* Love letter + Reasons */
    .scroll{
      padding: 16px;
      overflow:auto;
      max-height: calc(86vh - 58px);
      color: rgba(255,255,255,.92);
      line-height: 1.6;
    }
    .letter{
      white-space: pre-wrap;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 14px 14px;
    }
    .list{
      margin: 0;
      padding-left: 18px;
    }
    .list li{ margin: 8px 0; }

    /* Kiss/Hug toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 22px;
      transform: translateX(-50%);
      padding: 12px 16px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.20);
      background: rgba(20,20,20,.70);
      color: rgba(255,255,255,.94);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 55px rgba(0,0,0,.45);
      opacity: 0;
      pointer-events:none;
      transition: opacity 220ms ease, transform 220ms ease;
      z-index: 80;
      display:flex;
      gap: 10px;
      align-items:center;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-8px);
    }

    /* Memory game */
    .game{
      padding: 14px;
      overflow:auto;
      max-height: calc(86vh - 58px);
      color: rgba(255,255,255,.92);
    }
    .game-top{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    .game-stats{ opacity:.92; font-size: .95rem; }
    .grid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    @media (min-width: 720px){ .grid{ grid-template-columns: repeat(5, 1fr); } }
    .card2{
      aspect-ratio: 1/1.05;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      position:relative;
      overflow:hidden;
      perspective: 800px;
    }
    .inner{
      position:absolute; inset:0;
      transform-style: preserve-3d;
      transition: transform 240ms ease;
    }
    .card2.flipped .inner{ transform: rotateY(180deg); }
    .face{
      position:absolute; inset:0;
      backface-visibility: hidden;
      display:grid;
      place-items:center;
      font-weight: 800;
      color: rgba(255,255,255,.92);
    }
    .back{
      background: radial-gradient(circle at 30% 20%, rgba(255,255,255,.12), transparent 50%),
                  rgba(255,255,255,.06);
      font-size: 1.4rem;
    }
    .front{
      transform: rotateY(180deg);
    }
    .front img{
      width:100%; height:100%;
      object-fit: cover;
      display:block;
    }

    /* QR */
    .qr-wrap{
      display:grid;
      gap: 12px;
      padding: 16px;
      overflow:auto;
      max-height: calc(86vh - 58px);
      color: rgba(255,255,255,.92);
    }
    .qr-row{
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
    }
    .qr-box{
      background: rgba(255,255,255,.92);
      border-radius: 16px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,.12);
      width: 240px;
      height: 240px;
      display:grid;
      place-items:center;
    }
    .qr-help{
      opacity:.9;
      font-size: .95rem;
      text-align:center;
    }
    .input{
      width: min(640px, 100%);
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.95);
      padding: 12px 12px;
      outline: none;
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      .heart, .sparkle{ display:none; }
      .btn.primary{ animation:none; }
      body{ background-attachment: scroll; }
      .tile img, .inner{ transition:none; }
    }
  </style>
</head>

<body>
  <!-- Sparkles -->
  <div class="sparkles" aria-hidden="true" id="sparkles"></div>

  <main>
    <div class="card">
      <h1 class="title">
        <span class="script">Nonnyyy</span>
        <span class="main">i love u</span>
      </h1>

      <!-- Random sweet line -->
      <div class="random">
        <span id="randomLine">‚ô•Ô∏è</span>
        <button class="shuffle" id="shuffleLine" type="button">new message ‚ú®</button>
      </div>

      <!-- Countdown since you met -->
      <div class="countdown" aria-live="polite">
        <span class="pill">‚è≥ <span>Since we met:</span> <span class="mono" id="sinceMet">...</span></span>
        <span class="pill">üìÖ <span>Today:</span> <span class="mono" id="today">...</span></span>
      </div>

      <!-- Buttons -->
      <div class="btns">
        <button class="btn primary" id="openGallery" type="button">The most beautiful girl in the world ‚ô•Ô∏è üì∏</button>
        <button class="btn" id="openLetter" type="button">Open my letter üíå</button>
        <button class="btn" id="openReasons" type="button">Reasons I love you ü•π</button>
        <button class="btn" id="toggleMusic" type="button">Play music üéµ</button>
        <button class="btn" id="kissBtn" type="button">Kiss üíã</button>
        <button class="btn" id="hugBtn" type="button">Hug ü§ó</button>
        <button class="btn" id="openGame" type="button">Memory game üß©</button>
        <button class="btn" id="openQR" type="button">QR code üì±</button>
  
  </main>

  <!-- Floating hearts -->
  <div class="hearts" aria-hidden="true">
    <span class="heart" style="left: 10%; --dx: 18vw; animation-duration: 9s;  animation-delay: 0s;">‚ù§Ô∏è</span>
    <span class="heart" style="left: 28%; --dx: 10vw; animation-duration: 12s; animation-delay: 1s;">üíñ</span>
    <span class="heart" style="left: 52%; --dx: 22vw; animation-duration: 10s; animation-delay: 2s;">üíó</span>
    <span class="heart" style="left: 74%; --dx: 8vw;  animation-duration: 13s; animation-delay: 0.5s;">üíò</span>
    <span class="heart" style="left: 88%; --dx: 16vw; animation-duration: 11s; animation-delay: 1.5s;">üíï</span>
  </div>

  <!-- Toast for Kiss/Hug -->
  <div class="toast" id="toast" aria-live="polite"></div>

  <!-- Gallery Modal -->
  <div class="modal" id="galleryModal" role="dialog" aria-modal="true" aria-labelledby="galleryTitle">
    <div class="modal-card">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="galleryTitle">Nonnyyy‚Äôs Photos ‚ô•Ô∏è</div>
          <div class="modal-sub">Tap a photo to see it bigger</div>
        </div>
        <button class="close" data-close="galleryModal" type="button">Close ‚úï</button>
      </div>
      <div class="gallery" id="gallery"></div>
    </div>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true">
    <div class="lightbox-inner">
      <img id="lightboxImg" alt="Photo preview" />
      <div class="lb-bar">
        <button class="nav" id="prevBtn" type="button">‚óÄ Prev</button>
        <div class="counter" id="lbCounter">1 / 15</div>
        <button class="nav" id="nextBtn" type="button">Next ‚ñ∂</button>
      </div>
    </div>
  </div>

  <!-- Love Letter Modal -->
  <div class="modal" id="letterModal" role="dialog" aria-modal="true" aria-labelledby="letterTitle">
    <div class="modal-card">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="letterTitle">A letter for you üíå</div>
          <div class="modal-sub">Edit the text in the HTML if you want</div>
        </div>
        <button class="close" data-close="letterModal" type="button">Close ‚úï</button>
      </div>
      <div class="scroll">
        <div class="letter" id="letterText"></div>
      </div>
    </div>
  </div>

  <!-- Reasons Modal -->
  <div class="modal" id="reasonsModal" role="dialog" aria-modal="true" aria-labelledby="reasonsTitle">
    <div class="modal-card">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="reasonsTitle">Reasons I love you ü•π</div>
          <div class="modal-sub">Because you‚Äôre literally my favorite</div>
        </div>
        <button class="close" data-close="reasonsModal" type="button">Close ‚úï</button>
      </div>
      <div class="scroll">
        <ol class="list" id="reasonsList"></ol>
      </div>
    </div>
  </div>

  <!-- Memory Game Modal -->
  <div class="modal" id="gameModal" role="dialog" aria-modal="true" aria-labelledby="gameTitle">
    <div class="modal-card">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="gameTitle">Memory game üß©</div>
          <div class="modal-sub">Match the photos ‚Äî win a surprise ‚ô•Ô∏è</div>
        </div>
        <button class="close" data-close="gameModal" type="button">Close ‚úï</button>
      </div>
      <div class="game">
        <div class="game-top">
          <div class="game-stats">
            Moves: <span class="mono" id="moves">0</span> ‚Ä¢ Matches: <span class="mono" id="matches">0</span>/<span class="mono" id="totalPairs">0</span>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn" id="resetGame" type="button">Restart üîÑ</button>
            <button class="btn" id="winHint" type="button">Hint üòá</button>
          </div>
        </div>
        <div class="grid" id="gameGrid"></div>
      </div>
    </div>
  </div>

  <!-- QR Modal -->
  <div class="modal" id="qrModal" role="dialog" aria-modal="true" aria-labelledby="qrTitle">
    <div class="modal-card">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="qrTitle">QR code üì±</div>
          <div class="modal-sub">Scan it to open this page link</div>
        </div>
        <button class="close" data-close="qrModal" type="button">Close ‚úï</button>
      </div>

      <div class="qr-wrap">
        <div class="qr-help">
          If you host this page (GitHub Pages / Netlify), paste the URL below and it will generate a QR code.
        </div>

        <input class="input" id="qrInput" placeholder="Paste your page link here (example: https://yourname.github.io/nonny/)" />

        <div class="qr-row">
          <div class="qr-box">
            <canvas id="qrCanvas" width="220" height="220" aria-label="QR code"></canvas>
          </div>
        </div>

        <div class="qr-row">
          <button class="btn" id="makeQR" type="button">Generate QR ‚ú®</button>
          <button class="btn" id="useCurrent" type="button">Use current URL üåç</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Audio (your own file) -->
  <audio id="song" src="song.mp3" preload="auto"></audio>
  <!-- Audio -->
<audio id="song" src="song.mp3" preload="auto"></audio>

<!-- SFX -->
<audio id="kissSound" src="kiss.mp3" preload="auto"></audio>
<audio id="hugSound"  src="hug.mp3"  preload="auto"></audio>


  <script>
    /************************************************************
     * 1) CONFIG (edit these!)
     ************************************************************/
    // Put these files in the same folder as this HTML:
    // photo1.jpeg ... photo15.jpeg
    const photos = [
      { src: "photo1.jpeg",  cap: "Your smile = my favorite view ‚ô•Ô∏è" },
      { src: "photo2.jpeg",  cap: "Pretty in every universe ‚ú®" },
      { src: "photo3.jpeg",  cap: "Simple day, perfect you ‚ô•Ô∏è" },
      { src: "photo4.jpeg",  cap: "We look good‚Ä¶ but you look unreal ‚ô•Ô∏è" },
      { src: "photo5.jpeg",  cap: "The sweetest face in the world." },
      { src: "photo6.jpeg",  cap: "Just you‚Ä¶ perfect." },
      { src: "photo7.jpeg",  cap: "I‚Äôm proud of you always." },
      { src: "photo8.jpeg",  cap: "My safe place ü§ç" },
      { src: "photo9.jpeg",  cap: "I miss you when you‚Äôre not here." },
      { src: "photo10.jpeg", cap: "Forever looks good on us üíç" },
      { src: "photo11.jpeg", cap: "You make my heart smile ‚ô•Ô∏è" },
      { src: "photo12.jpeg", cap: "My favorite person, always ‚ú®" },
      { src: "photo13.jpeg", cap: "Beautiful doesn‚Äôt even explain it üò≠" },
      { src: "photo14.jpeg", cap: "I love you more every day üíñ" },
      { src: "photo15.jpeg", cap: "You‚Äôre my forever üíç‚ô•Ô∏è" },
    ];

    // Set the date/time you met (local time)
    const MET_DATE_ISO = "2025-02-08T00:00:00";

    // Love letter text (edit freely)
    const LOVE_LETTER = `
Nonnyyy ‚ô•Ô∏è

Your presence in my life is a blessing.
Just having you here ‚Äî even in the smallest moments ‚Äî makes everything feel better.
You‚Äôre my calm, my happiness, and my favorite person.

‚Äî siso ü§ç
`.trim();

    // Reasons list (edit / add as many as you want)
    const REASONS = [
      "Your smile is magic.",
      "You make me feel safe.",
      "Your eyes have their own light.",
      "You‚Äôre kind even when you don‚Äôt have to be.",
      "You‚Äôre beautiful without trying.",
      "You‚Äôre my peace.",
      "You make boring days feel special.",
      "I love your laugh.",
      "I love how you care.",
      "I love you. That‚Äôs it. ‚ô•Ô∏è"
    ];

    // Random sweet messages
    const SWEET_LINES = [
      "You‚Äôre my favorite notification ‚ô•Ô∏è",
      "If beauty had a name: Nonnyyy ‚ú®",
      "I miss you more than words.",
      "I‚Äôm proud of you, always.",
      "Your smile is my comfort.",
      "You‚Äôre my best thought of the day.",
      "You‚Äôre the prettiest part of my life."
    ];

    /************************************************************
     * 2) HELPERS
     ************************************************************/
    const $ = (id) => document.getElementById(id);
    const open = (id) => $(id).classList.add("open");
    const close = (id) => $(id).classList.remove("open");
    const pad2 = (n) => String(n).padStart(2, "0");

    function formatSince(ms){
      const s = Math.max(0, Math.floor(ms / 1000));
      const days = Math.floor(s / 86400);
      const hrs  = Math.floor((s % 86400) / 3600);
      const mins = Math.floor((s % 3600) / 60);
      const secs = s % 60;
      return `${days}d ${pad2(hrs)}:${pad2(mins)}:${pad2(secs)}`;
    }

    function showToast(html){
      const t = $("toast");
      t.innerHTML = html;
      t.classList.add("show");
      clearTimeout(showToast._tm);
      showToast._tm = setTimeout(()=> t.classList.remove("show"), 1400);
    }
function playSfx(id){
  const a = document.getElementById(id);
  if(!a) return;
  a.currentTime = 0;
  a.play().catch(()=>{});
}

    // Tiny cute sound (no external file needed)
    function beep(freq=660, dur=0.10){
      try{
        const ctx = beep._ctx || (beep._ctx = new (window.AudioContext || window.webkitAudioContext)());
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "sine";
        o.frequency.value = freq;
        g.gain.value = 0.06;
        o.connect(g); g.connect(ctx.destination);
        o.start();
        o.stop(ctx.currentTime + dur);
      }catch(e){}
    }

    /************************************************************
     * 3) SPARKLES
     ************************************************************/
    (function makeSparkles(){
      const root = $("sparkles");
      const count = 14;
      for(let i=0;i<count;i++){
        const s = document.createElement("div");
        s.className = "sparkle";
        s.style.left = Math.random()*100 + "%";
        s.style.top = (60 + Math.random()*60) + "%";
        s.style.animationDuration = (3.5 + Math.random()*3.5) + "s";
        s.style.animationDelay = (Math.random()*3.0) + "s";
        root.appendChild(s);
      }
    })();

    /************************************************************
     * 4) RANDOM MESSAGE
     ************************************************************/
    function setRandomLine(){
      const line = SWEET_LINES[Math.floor(Math.random()*SWEET_LINES.length)];
      $("randomLine").textContent = line;
    }
    $("shuffleLine").addEventListener("click", () => {
      setRandomLine();
      beep(740, 0.08);
    });
    setRandomLine();

    /************************************************************
     * 5) COUNTDOWN (since you met)
     ************************************************************/
    const metDate = new Date(MET_DATE_ISO);
    function tick(){
      const now = new Date();
      $("sinceMet").textContent = formatSince(now - metDate);
      $("today").textContent = now.toLocaleString();
    }
    tick();
    setInterval(tick, 1000);

    /************************************************************
     * 6) GALLERY + CAPTIONS + LIGHTBOX
     ************************************************************/
    const gallery = $("gallery");
    const lightbox = $("lightbox");
    const lbImg = $("lightboxImg");
    const lbCounter = $("lbCounter");
    let currentIndex = 0;

    photos.forEach((p, i) => {
      const tile = document.createElement("button");
      tile.className = "tile";
      tile.type = "button";
      tile.setAttribute("aria-label", `Open photo ${i+1}`);
      tile.innerHTML = `
        <img src="${p.src}" alt="Photo ${i+1}">
        <div class="cap">${p.cap}</div>
      `;
      tile.addEventListener("click", () => openLightbox(i));
      gallery.appendChild(tile);
    });

    function updateLightbox(){
      lbImg.src = photos[currentIndex].src;
      lbCounter.textContent = `${currentIndex+1} / ${photos.length}`;
    }
    function openLightbox(i){
      currentIndex = i;
      updateLightbox();
      lightbox.classList.add("open");
      beep(660, 0.08);
    }
    function closeLightbox(){ lightbox.classList.remove("open"); }
    function prev(){ currentIndex = (currentIndex - 1 + photos.length) % photos.length; updateLightbox(); }
    function next(){ currentIndex = (currentIndex + 1) % photos.length; updateLightbox(); }

    $("prevBtn").addEventListener("click", prev);
    $("nextBtn").addEventListener("click", next);
    lightbox.addEventListener("click", (e) => { if(e.target === lightbox) closeLightbox(); });

    /************************************************************
     * 7) LOVE LETTER + REASONS
     ************************************************************/
    $("letterText").textContent = LOVE_LETTER;
    const reasonsEl = $("reasonsList");
    reasonsEl.innerHTML = "";
    REASONS.forEach(r => {
      const li = document.createElement("li");
      li.textContent = r;
      reasonsEl.appendChild(li);
    });

    /************************************************************
     * 8) MUSIC BUTTON + AUTOSTART AFTER FIRST TAP
     ************************************************************/
    const song = $("song");
    const musicBtn = $("toggleMusic");
    let playing = false;

    // Auto-start music after the first user interaction (works on phones)
    let autoStarted = false;

    async function tryAutoStartMusic() {
      if (autoStarted) return;
      autoStarted = true;

      try {
        await song.play();
        playing = true;
        musicBtn.textContent = "Pause music ‚è∏Ô∏è";
        showToast("üéµ Music started");
      } catch (e) {
        // user can still press the Play button
      }
    }

    window.addEventListener("pointerdown", tryAutoStartMusic, { once: true });
    window.addEventListener("keydown", tryAutoStartMusic, { once: true });

    async function toggleMusic(){
      try{
        if(!playing){
          await song.play();
          playing = true;
          musicBtn.textContent = "Pause music ‚è∏Ô∏è";
          showToast("üéµ Music on");
        }else{
          song.pause();
          playing = false;
          musicBtn.textContent = "Play music üéµ";
          showToast("üîá Music off");
        }
      }catch(e){
        showToast("‚ö†Ô∏è Add song.mp3 in the folder");
      }
    }
    musicBtn.addEventListener("click", toggleMusic);

    /************************************************************
     * 9) KISS / HUG buttons + effect
     ************************************************************/
    function burstEmoji(emoji){
      const count = 14;
      for(let i=0;i<count;i++){
        const el = document.createElement("div");
        el.className = "trail-heart";
        el.textContent = emoji;
        const x = window.innerWidth/2 + (Math.random()*120 - 60);
        const y = window.innerHeight/2 + (Math.random()*80 - 40);
        el.style.left = x + "px";
        el.style.top  = y + "px";
        el.style.setProperty("--dx", (Math.random()*180 - 90) + "px");
        el.style.setProperty("--dy", (Math.random()*-220 - 80) + "px");
        document.body.appendChild(el);
        setTimeout(()=> el.remove(), 950);
      }
    }

  $("kissBtn").addEventListener("click", () => {
  burstEmoji("üíã");
  playSfx("kissSound");
  showToast("üíã MWAH! a kiss for you");
});

$("hugBtn").addEventListener("click", () => {
  burstEmoji("ü§ó");
  playSfx("hugSound");
  showToast("ü§ó Big warm hug!");
});

    /************************************************************
     * 10) HEART TRAIL (mouse/touch)
     ************************************************************/
    const trailEmojis = ["‚ô•Ô∏è","üíñ","‚ú®","üíï","üíò"];
    let lastTrail = 0;

    function makeTrail(x,y){
      const now = performance.now();
      if(now - lastTrail < 28) return;
      lastTrail = now;

      const el = document.createElement("div");
      el.className = "trail-heart";
      el.textContent = trailEmojis[(Math.random()*trailEmojis.length)|0];
      el.style.left = x + "px";
      el.style.top  = y + "px";
      el.style.setProperty("--dx", (Math.random()*90 - 45) + "px");
      el.style.setProperty("--dy", (Math.random()*-160 - 60) + "px");
      document.body.appendChild(el);
      setTimeout(()=> el.remove(), 920);
    }

    window.addEventListener("mousemove", (e) => makeTrail(e.clientX, e.clientY), { passive:true });
    window.addEventListener("touchmove", (e) => {
      const t = e.touches && e.touches[0];
      if(t) makeTrail(t.clientX, t.clientY);
    }, { passive:true });

    /************************************************************
     * 11) MEMORY GAME (uses photos as cards)
     ************************************************************/
    const gameGrid = $("gameGrid");
    const movesEl = $("moves");
    const matchesEl = $("matches");
    const totalPairsEl = $("totalPairs");

    let cards = [];
    let flipped = [];
    let lock = false;
    let moves = 0;
    let matches = 0;

    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function buildGame(){
      gameGrid.innerHTML = "";
      moves = 0; matches = 0;
      flipped = []; lock = false;
      movesEl.textContent = "0";
      matchesEl.textContent = "0";

      const base = photos.map((p, idx) => ({ id: idx, src: p.src }));
      cards = shuffle([...base, ...base].map((c, k) => ({ ...c, key: k })));
      totalPairsEl.textContent = String(base.length);

      cards.forEach((c) => {
        const btn = document.createElement("button");
        btn.className = "card2";
        btn.type = "button";
        btn.dataset.id = String(c.id);
        btn.dataset.key = String(c.key);
        btn.innerHTML = `
          <div class="inner">
            <div class="face back">‚ô•Ô∏è</div>
            <div class="face front"><img src="${c.src}" alt="Game photo"></div>
          </div>
        `;
        btn.addEventListener("click", () => flipCard(btn));
        gameGrid.appendChild(btn);
      });
    }

    function flipCard(btn){
      if(lock) return;
      if(btn.classList.contains("flipped")) return;

      btn.classList.add("flipped");
      flipped.push(btn);
      beep(640, 0.06);

      if(flipped.length === 2){
        moves++;
        movesEl.textContent = String(moves);
        const [a,b] = flipped;
        const same = a.dataset.id === b.dataset.id;

        lock = true;
        setTimeout(() => {
          if(same){
            matches++;
            matchesEl.textContent = String(matches);
            showToast("‚úÖ Matched!");
            beep(820, 0.08);
            flipped = [];
            lock = false;

            if(matches === photos.length){
              burstEmoji("‚ô•Ô∏è");
              showToast("üéÅ Your gift: 100 kisses üíã‚ú®");
burstEmoji("üéÅ");
            }
          }else{
            a.classList.remove("flipped");
            b.classList.remove("flipped");
            flipped = [];
            lock = false;
          }
        }, 520);
      }
    }

    $("resetGame").addEventListener("click", () => {
      buildGame();
      showToast("üîÑ Restarted!");
      beep(520, 0.08);
    });

    $("winHint").addEventListener("click", () => {
      const all = [...document.querySelectorAll(".card2")];
      all.forEach(c => c.classList.add("flipped"));
      setTimeout(() => all.forEach(c => c.classList.remove("flipped")), 650);
      showToast("üòá Quick peek!");
      beep(740, 0.08);
    });

    /************************************************************
     * 12) QR CODE (minimal)
     ************************************************************/
    function drawQR(text){
      const canvas = $("qrCanvas");
      const ctx = canvas.getContext("2d");
      const size = canvas.width;

      try{
        const qr = qrcode(0, "M");
        qr.addData(text);
        qr.make();

        const cells = qr.getModuleCount();
        const scale = Math.floor(size / cells);
        const pad = Math.floor((size - cells * scale) / 2);

        ctx.clearRect(0,0,size,size);
        ctx.fillStyle = "#fff";
        ctx.fillRect(0,0,size,size);
        ctx.fillStyle = "#000";

        for(let r=0;r<cells;r++){
          for(let c=0;c<cells;c++){
            if(qr.isDark(r,c)){
              ctx.fillRect(pad + c*scale, pad + r*scale, scale, scale);
            }
          }
        }
      }catch(e){
        ctx.clearRect(0,0,size,size);
        ctx.fillStyle = "#fff"; ctx.fillRect(0,0,size,size);
        ctx.fillStyle = "#000";
        for(let i=0;i<420;i++){
          ctx.fillRect(Math.random()*size, Math.random()*size, 2, 2);
        }
      }
    }

    function qrcode(typeNumber, errorCorrectionLevel) {
      var qr = {};
      var _typeNumber = typeNumber;
      var _errorCorrectionLevel = QRErrorCorrectionLevel[errorCorrectionLevel];
      var _modules = null;
      var _moduleCount = 0;
      var _dataCache = null;
      var _dataList = [];

      qr.addData = function(data) {
        var newData = new QR8bitByte(data);
        _dataList.push(newData);
        _dataCache = null;
      };

      qr.isDark = function(row, col) {
        if (_modules[row][col] != null) return _modules[row][col];
        return false;
      };

      qr.getModuleCount = function() {
        return _moduleCount;
      };

      qr.make = function() {
        if (_typeNumber < 1) _typeNumber = 1;
        makeImpl(false, getBestMaskPattern());
      };

      function makeImpl(test, maskPattern) {
        _moduleCount = _typeNumber * 4 + 17;
        _modules = new Array(_moduleCount);
        for (var row = 0; row < _moduleCount; row++) {
          _modules[row] = new Array(_moduleCount);
          for (var col = 0; col < _moduleCount; col++) _modules[row][col] = null;
        }

        setupPositionProbePattern(0, 0);
        setupPositionProbePattern(_moduleCount - 7, 0);
        setupPositionProbePattern(0, _moduleCount - 7);
        setupPositionAdjustPattern();
        setupTimingPattern();
        setupTypeInfo(test, maskPattern);

        if (_typeNumber >= 7) setupTypeNumber(test);

        if (_dataCache == null) _dataCache = createData(_typeNumber, _errorCorrectionLevel, _dataList);
        mapData(_dataCache, maskPattern);
      }

      function setupPositionProbePattern(row, col) {
        for (var r = -1; r <= 7; r++) {
          if (row + r <= -1 || _moduleCount <= row + r) continue;
          for (var c = -1; c <= 7; c++) {
            if (col + c <= -1 || _moduleCount <= col + c) continue;
            if ((0 <= r && r <= 6 && (c == 0 || c == 6)) ||
              (0 <= c && c <= 6 && (r == 0 || r == 6)) ||
              (2 <= r && r <= 4 && 2 <= c && c <= 4)) {
              _modules[row + r][col + c] = true;
            } else {
              _modules[row + r][col + c] = false;
            }
          }
        }
      }

      function getBestMaskPattern() {
        var minLostPoint = 0;
        var pattern = 0;
        for (var i = 0; i < 8; i++) {
          makeImpl(true, i);
          var lostPoint = QRUtil.getLostPoint(qr);
          if (i == 0 || minLostPoint > lostPoint) {
            minLostPoint = lostPoint;
            pattern = i;
          }
        }
        return pattern;
      }

      function setupTimingPattern() {
        for (var i = 8; i < _moduleCount - 8; i++) {
          if (_modules[i][6] != null) continue;
          _modules[i][6] = (i % 2 == 0);
          if (_modules[6][i] != null) continue;
          _modules[6][i] = (i % 2 == 0);
        }
      }

      function setupPositionAdjustPattern() {
        var pos = QRUtil.getPatternPosition(_typeNumber);
        for (var i = 0; i < pos.length; i++) {
          for (var j = 0; j < pos.length; j++) {
            var row = pos[i];
            var col = pos[j];
            if (_modules[row][col] != null) continue;
            for (var r = -2; r <= 2; r++) {
              for (var c = -2; c <= 2; c++) {
                if (r == -2 || r == 2 || c == -2 || c == 2 || (r == 0 && c == 0)) {
                  _modules[row + r][col + c] = true;
                } else {
                  _modules[row + r][col + c] = false;
                }
              }
            }
          }
        }
      }

      function setupTypeNumber(test) {
        var bits = QRUtil.getBCHTypeNumber(_typeNumber);
        for (var i = 0; i < 18; i++) {
          var mod = (!test && ((bits >> i) & 1) == 1);
          _modules[Math.floor(i / 3)][i % 3 + _moduleCount - 8 - 3] = mod;
        }
        for (var i = 0; i < 18; i++) {
          var mod = (!test && ((bits >> i) & 1) == 1);
          _modules[i % 3 + _moduleCount - 8 - 3][Math.floor(i / 3)] = mod;
        }
      }

      function setupTypeInfo(test, maskPattern) {
        var data = (_errorCorrectionLevel << 3) | maskPattern;
        var bits = QRUtil.getBCHTypeInfo(data);

        for (var i = 0; i < 15; i++) {
          var mod = (!test && ((bits >> i) & 1) == 1);
          if (i < 6) _modules[i][8] = mod;
          else if (i < 8) _modules[i + 1][8] = mod;
          else _modules[_moduleCount - 15 + i][8] = mod;
        }

        for (var i = 0; i < 15; i++) {
          var mod = (!test && ((bits >> i) & 1) == 1);
          if (i < 8) _modules[8][_moduleCount - i - 1] = mod;
          else if (i < 9) _modules[8][15 - i - 1 + 1] = mod;
          else _modules[8][15 - i - 1] = mod;
        }

        _modules[_moduleCount - 8][8] = (!test);
      }

      function mapData(data, maskPattern) {
        var inc = -1;
        var row = _moduleCount - 1;
        var bitIndex = 7;
        var byteIndex = 0;

        for (var col = _moduleCount - 1; col > 0; col -= 2) {
          if (col == 6) col--;
          while (true) {
            for (var c = 0; c < 2; c++) {
              if (_modules[row][col - c] == null) {
                var dark = false;
                if (byteIndex < data.length) {
                  dark = (((data[byteIndex] >>> bitIndex) & 1) == 1);
                }
                var mask = QRUtil.getMask(maskPattern, row, col - c);
                if (mask) dark = !dark;
                _modules[row][col - c] = dark;
                bitIndex--;
                if (bitIndex == -1) {
                  byteIndex++;
                  bitIndex = 7;
                }
              }
            }
            row += inc;
            if (row < 0 || _moduleCount <= row) {
              row -= inc;
              inc = -inc;
              break;
            }
          }
        }
      }

      function createData(typeNumber, errorCorrectionLevel, dataList) {
        var rsBlocks = QRRSBlock.getRSBlocks(typeNumber, errorCorrectionLevel);
        var buffer = new QRBitBuffer();

        for (var i = 0; i < dataList.length; i++) {
          var data = dataList[i];
          buffer.put(data.getMode(), 4);
          buffer.put(data.getLength(), QRUtil.getLengthInBits(data.getMode(), typeNumber));
          data.write(buffer);
        }

        var totalDataCount = 0;
        for (var i = 0; i < rsBlocks.length; i++) totalDataCount += rsBlocks[i].dataCount;

        if (buffer.getLengthInBits() > totalDataCount * 8) {
          throw new Error("Too long data");
        }

        if (buffer.getLengthInBits() + 4 <= totalDataCount * 8) buffer.put(0, 4);
        while (buffer.getLengthInBits() % 8 != 0) buffer.putBit(false);

        while (true) {
          if (buffer.getLengthInBits() >= totalDataCount * 8) break;
          buffer.put(QRUtil.PAD0, 8);
          if (buffer.getLengthInBits() >= totalDataCount * 8) break;
          buffer.put(QRUtil.PAD1, 8);
        }

        return QRUtil.createBytes(buffer, rsBlocks);
      }

      return qr;
    }

    var QRErrorCorrectionLevel = { L:1, M:0, Q:3, H:2 };

    function QR8bitByte(data) {
      this.mode = QRMode.MODE_8BIT_BYTE;
      this.data = data;
      this.parsedData = [];
      for (var i = 0; i < this.data.length; i++) this.parsedData.push(this.data.charCodeAt(i));
      this.getLength = function() { return this.parsedData.length; };
      this.write = function(buffer) { for (var i = 0; i < this.parsedData.length; i++) buffer.put(this.parsedData[i], 8); };
      this.getMode = function() { return this.mode; };
    }

    var QRMode = { MODE_8BIT_BYTE: 2 };

    function QRBitBuffer() {
      this.buffer = [];
      this.length = 0;
      this.get = function(index) {
        var bufIndex = Math.floor(index / 8);
        return ((this.buffer[bufIndex] >>> (7 - index % 8)) & 1) == 1;
      };
      this.put = function(num, length) {
        for (var i = 0; i < length; i++) this.putBit(((num >>> (length - i - 1)) & 1) == 1);
      };
      this.putBit = function(bit) {
        var bufIndex = Math.floor(this.length / 8);
        if (this.buffer.length <= bufIndex) this.buffer.push(0);
        if (bit) this.buffer[bufIndex] |= (0x80 >>> (this.length % 8));
        this.length++;
      };
      this.getLengthInBits = function() { return this.length; };
    }

    var QRUtil = {
      PATTERN_POSITION_TABLE: [
        [], [6,18], [6,22], [6,26], [6,30],
        [6,34], [6,38], [6,42], [6,46], [6,50]
      ],
      G15: (1<<10) | (1<<8) | (1<<5) | (1<<4) | (1<<2) | (1<<1) | (1<<0),
      G18: (1<<12) | (1<<11) | (1<<10) | (1<<9) | (1<<8) | (1<<5) | (1<<2) | (1<<0),
      G15_MASK: (1<<14) | (1<<12) | (1<<10) | (1<<4) | (1<<1),
      PAD0: 0xEC,
      PAD1: 0x11,

      getBCHTypeInfo: function(data) {
        var d = data << 10;
        while (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G15) >= 0) {
          d ^= (QRUtil.G15 << (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G15)));
        }
        return ((data << 10) | d) ^ QRUtil.G15_MASK;
      },

      getBCHTypeNumber: function(data) {
        var d = data << 12;
        while (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G18) >= 0) {
          d ^= (QRUtil.G18 << (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G18)));
        }
        return (data << 12) | d;
      },

      getBCHDigit: function(data) {
        var digit = 0;
        while (data != 0) { digit++; data >>>= 1; }
        return digit;
      },

      getPatternPosition: function(typeNumber) {
        return QRUtil.PATTERN_POSITION_TABLE[typeNumber] || [6, 18];
      },

      getMask: function(maskPattern, i, j) {
        switch (maskPattern) {
          case 0: return (i + j) % 2 == 0;
          case 1: return i % 2 == 0;
          case 2: return j % 3 == 0;
          case 3: return (i + j) % 3 == 0;
          case 4: return (Math.floor(i / 2) + Math.floor(j / 3)) % 2 == 0;
          case 5: return (i * j) % 2 + (i * j) % 3 == 0;
          case 6: return ((i * j) % 2 + (i * j) % 3) % 2 == 0;
          case 7: return ((i * j) % 3 + (i + j) % 2) % 2 == 0;
          default: return false;
        }
      },

      getLengthInBits: function(mode, type) {
        if (type < 10) return 8;
        return 16;
      },

      createBytes: function(buffer, rsBlocks) {
        var data = [];
        for (var i = 0; i < buffer.buffer.length; i++) data.push(buffer.buffer[i]);
        return data;
      },

      getLostPoint: function(qr) {
        var moduleCount = qr.getModuleCount();
        var lostPoint = 0;

        for (var row = 0; row < moduleCount; row++) {
          for (var col = 0; col < moduleCount; col++) {
            var sameCount = 0;
            var dark = qr.isDark(row, col);

            for (var r = -1; r <= 1; r++) {
              if (row + r < 0 || moduleCount <= row + r) continue;
              for (var c = -1; c <= 1; c++) {
                if (col + c < 0 || moduleCount <= col + c) continue;
                if (r == 0 && c == 0) continue;
                if (dark == qr.isDark(row + r, col + c)) sameCount++;
              }
            }
            if (sameCount > 5) lostPoint += (3 + sameCount - 5);
          }
        }
        return lostPoint;
      }
    };

    var QRRSBlock = {
      getRSBlocks: function(typeNumber, errorCorrectionLevel) {
        return [{ totalCount: 26, dataCount: 19 }];
      }
    };

    /************************************************************
     * 13) MODAL WIRES + BUTTONS
     ************************************************************/
    function wireClose(){
      document.querySelectorAll("[data-close]").forEach(btn => {
        btn.addEventListener("click", () => close(btn.dataset.close));
      });
      document.querySelectorAll(".modal").forEach(m => {
        m.addEventListener("click", (e) => { if(e.target === m) m.classList.remove("open"); });
      });
    }
    wireClose();

    $("openGallery").addEventListener("click", () => { open("galleryModal"); beep(660, 0.08); });
    $("openLetter").addEventListener("click", () => { open("letterModal"); beep(740, 0.08); });
    $("openReasons").addEventListener("click", () => { open("reasonsModal"); beep(740, 0.08); });

    $("openGame").addEventListener("click", () => {
      open("gameModal");
      buildGame();
      beep(660, 0.08);
    });

    $("openQR").addEventListener("click", () => {
      open("qrModal");
      $("qrInput").value = "";
      drawQR("https://example.com");
      beep(660, 0.08);
    });

    $("makeQR").addEventListener("click", () => {
      const v = $("qrInput").value.trim();
      if(!v){
        showToast("‚úçÔ∏è Paste a link first");
        return;
      }
      drawQR(v);
      showToast("‚úÖ QR generated");
      beep(820, 0.08);
    });

    $("useCurrent").addEventListener("click", () => {
      const url = location.href;
      $("qrInput").value = url;
      drawQR(url);
      showToast("üåç Using current URL");
      beep(820, 0.08);
    });

    // Keyboard controls
    document.addEventListener("keydown", (e) => {
      if(e.key === "Escape"){
        closeLightbox();
        document.querySelectorAll(".modal.open").forEach(m => m.classList.remove("open"));
      }
      if(lightbox.classList.contains("open")){
        if(e.key === "ArrowLeft") prev();
        if(e.key === "ArrowRight") next();
      }
    });
  </script>
</body>
</html>
